<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>x = room_width/2;
y = room_height/2;
sprite_index = s_mask_human;

mass = 10;
acceleration = 0.1;
move_speed = 5;

can_shoot = true;
shoot_delay = 6;

muzzle_flash_p_emitter = part_emitter_create(global.p_sys);
muzzle_flash_p_type = part_type_create();

// Bindings
key_up = ord("W");
key_down = ord("S");
key_left = ord("A");
key_right = ord("D");
key_reload = vk_space;
mb_shoot = mb_left;

// Sprite (Body)
s_torso_current = s_torso_wpn;
walk_wave_t = 0;
walk_wave_inc = 15;
s_feet_image_index = 0;
s_feet_image_xscale = 1;

// Weapon
base_dist_1h = 17;// pixel distance from torso sprite center to weapon sprite center
base_dist_2h = 0;

w_index = 0;
w_inventory = ds_list_create();
ds_list_add(w_inventory, ITEM.pistol);
ds_list_add(w_inventory, ITEM.revolver);
//ds_list_add(w_inventory, ITEM.smg);
w_current = global.items[ds_list_find_value(w_inventory, w_index)];
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="1" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Cleanup

part_emitter_destroy(global.p_sys, muzzle_flash_p_emitter);
part_type_destroy(muzzle_flash_p_type);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// can_shoot = true

can_shoot = true;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="2">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Shooting

/*
switch (w_current[WPN.action]) {
    case WPN_ACTION.semi_auto:
        if (mouse_check_button_pressed(mb_shoot)) {
        }
        break;
    case WPN_ACTION.automatic:
        if (mouse_check_button(mb_shoot) &amp;&amp; can_shoot) {
        }
        break;
    case WPN_ACTION.single_shot:
        if (mouse_check_button_pressed(mb_shoot) &amp;&amp; can_shoot) {
        }
        break;
}
*/

var spread = 5;
if (mouse_check_button(mb_shoot) &amp;&amp; can_shoot) {
    audio_play_sound(w_current[WPN.sound_fire], 0, 0);
    audio_sound_pitch(w_current[WPN.sound_fire], random_range(0.8, 1));
    //repeat(5) {
        with(
            instance_create(
                x + lengthdir_x(global.wpn_carry_offset[w_current[WPN.carry]] + w_current[WPN.muzzle_offset], image_angle),
                y + lengthdir_y(global.wpn_carry_offset[w_current[WPN.carry]] + w_current[WPN.muzzle_offset], image_angle),
                o_bullet
            )
        ) {
            speed = 50 + random_range(-3, 3);  // WPN.proj_speed (missiles have acceleration though)
            direction = other.image_angle + random_range(-spread/2, spread/2); // WPN.spread
            // damage = wpn_current[WPN.damage];
            force = other.w_current[WPN.proj_force];
        }
    //}
    
    with (
        instance_create(
            x + lengthdir_x(global.wpn_carry_offset[w_current[WPN.carry]], image_angle),
            y + lengthdir_y(global.wpn_carry_offset[w_current[WPN.carry]], image_angle),
            o_casing
        )
    ) {
        image_angle = other.image_angle;
        direction = other.image_angle - 90 + random_range(-45, 45);
        speed = random_range(3, 5);
        image_index = 0;  // ammo_type?
    }
    
    muzzle_flash(
        x + lengthdir_x(global.wpn_carry_offset[w_current[WPN.carry]] + w_current[WPN.muzzle_offset], image_angle),
        y + lengthdir_y(global.wpn_carry_offset[w_current[WPN.carry]] + w_current[WPN.muzzle_offset], image_angle),
        4, 0, 32, image_angle, muzzle_flash_p_emitter, muzzle_flash_p_type
    );

    shake_screen(6, 10);
    
    can_shoot = false;
    alarm[0] = shoot_delay;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Movement

// Orientation
image_angle = point_direction(x, y, o_crosshair.x, o_crosshair.y);

// - Keyboard -
var move_up, move_down, move_left, move_right;
var set_speed;

move_up = keyboard_check(key_up);
move_down = keyboard_check(key_down);
move_left = keyboard_check(key_left);
move_right = keyboard_check(key_right);

var set_speed;
if ((move_up &amp;&amp; move_left) || (move_up &amp;&amp; move_right) || (move_down &amp;&amp; move_left) || (move_down &amp;&amp; move_right)) {
    set_speed = cos(degtorad(45)) * move_speed;
}
else {
    set_speed = move_speed;
}

// Horizontal Movement
if (move_up &amp;&amp; ! move_down) {
    vspeed = lerp(vspeed, -set_speed, acceleration);
}
else if (move_down &amp;&amp; !move_up) {
    vspeed = lerp(vspeed, set_speed, acceleration);
}
else if (!move_down &amp;&amp; !move_up) {
    vspeed = lerp(vspeed, 0, acceleration);
}
// Vertical Movement
if (move_left &amp;&amp; !move_right) {
    hspeed = lerp(hspeed, -set_speed, acceleration);
}
else if (move_right &amp;&amp; !move_left) {
    hspeed = lerp(hspeed, set_speed, acceleration);
}
else if (!move_right &amp;&amp; !move_left) {
    hspeed = lerp(hspeed, 0, acceleration);
}

// Handle feet sprite (make into script, get_src_vars())
var amplitude = sprite_get_number(s_feet) - 0.9;
var wave_val = amplitude * sin(degtorad(walk_wave_t));
s_feet_image_index = abs(wave_val);
if (wave_val &lt; 0) {
    s_feet_image_xscale = -1;
}
else {
    s_feet_image_xscale = 1;
}

if (move_up || move_down || move_left || move_right) {
    walk_wave_t += walk_wave_inc; 
}
else {
    if (abs(wave_val) &gt; 0.1) {
        if (abs(wave_val) &lt; abs(amplitude * sin(degtorad(walk_wave_t + 1)))) {
            walk_wave_t -= walk_wave_inc;
        }
        else if (abs(wave_val) &gt;= abs(amplitude * sin(degtorad(walk_wave_t + 1)))) {
            walk_wave_t += walk_wave_inc;    
        }
    }
    else {
        walk_wave_t = 0;
    }
}

// - Gamepad -
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Barrier &amp; Motherlode Collision

// Barrier
var dist = point_distance(x, y, o_motherlode.x, o_motherlode.y);
var dir = point_direction(x, y, o_motherlode.x, o_motherlode.y);
var diff = dist - global.barrier_radius;

if (diff &gt; 0) {
    x += lengthdir_x(diff, dir);
    y += lengthdir_y(diff, dir);
}

// Motherlode
diff = dist - o_motherlode.radius;

if (diff &lt; 0) {
    x += lengthdir_x(diff, dir);
    y += lengthdir_y(diff, dir);
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// (Dev) Weapon Swap

if (mouse_wheel_up() &amp;&amp; w_index &lt; ds_list_size(w_inventory) - 1) {
    w_index++;
    w_current = global.items[ds_list_find_value(w_inventory, w_index)];
}
if (mouse_wheel_down() &amp;&amp; w_index &gt; 0) {
    w_index--;
    w_current = global.items[ds_list_find_value(w_inventory, w_index)];
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="o_collider">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Collision checking

//Set up vars
var dir, xoff, yoff, om, mm, mag;

dir = point_direction(x, y, other.x, other.y);    //Get the direction from the colliding object
xoff = lengthdir_x(1, dir);                       //Get the offset vector
yoff = lengthdir_y(1, dir);
om = other.mass / mass;                         //start the fake "physics mass" calculations
mm = mass / other.mass;
mag = sqrt((om * om) + (mm * mm));
om /= mag;
mm /= mag;

//Move out of collision
while (place_meeting(x, y, other)) {
    x -= xoff * om; //Move the instance out of collision
    y -= yoff * om;
    other.x += xoff * mm; //Move the other instance out of the collision
    other.y += yoff * mm;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Body &amp; Weapon

// Feet
draw_sprite_ext(
    s_feet, s_feet_image_index, x, y, 
    s_feet_image_xscale, 1, direction, c_white, 1
);
// Torso (shadow)
draw_sprite_shadow_ext(
    s_torso_current, w_current[WPN.carry], x, y, image_angle,
    270, 5, 1, 1, c_black, 0.5
);
// Weapon (shadow)
draw_sprite_shadow_ext(
    s_w_primary, w_current[WPN.sprite_frame_index],
    x + lengthdir_x(global.wpn_carry_offset[w_current[WPN.carry]], image_angle), 
    y + lengthdir_y(global.wpn_carry_offset[w_current[WPN.carry]], image_angle),
    image_angle,
    270, 5, 1, 1, c_black, 0.5
);
// Torso (sprite)
draw_sprite_ext(s_torso_current, w_current[WPN.carry], x, y, 1, 1, image_angle, c_white, 1);
// Head
draw_sprite_shadow_ext(
    s_plr_head, 0, x, y, image_angle,
    270, 3, 1, 1, c_black, 0.5,
);
draw_sprite_ext(s_plr_head, 0, x, y, 1, 1, image_angle, c_white, 1);
// Weapon (sprite)
draw_sprite_ext(
    s_w_primary, w_current[WPN.sprite_frame_index], 
    x + lengthdir_x(global.wpn_carry_offset[w_current[WPN.carry]], image_angle), 
    y + lengthdir_y(global.wpn_carry_offset[w_current[WPN.carry]], image_angle),
    1, 1, image_angle, c_white, 1,
);
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Line Of Sight

var max_len = 200;
var min_len = 100;
var len = point_distance(x, y, o_crosshair.x, o_crosshair.y) * max_len / (room_width/4);
if (len &lt; min_len) {
    len = min_len;
}
if (len &gt; max_len) {
    len = max_len;
}

draw_set_colour(c_white);
draw_set_alpha(0.3);
draw_line_width(
    x + lengthdir_x(50, image_angle),
    y + lengthdir_y(50, image_angle),
    x + lengthdir_x(len, image_angle), 
    y + lengthdir_y(len, image_angle),
    2
);
draw_set_alpha(1);

</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Footprints
if (s_feet_image_index &gt;= sprite_get_number(s_feet) - 1) {
    surface_set_target(global.surf);
    draw_sprite_ext(s_footprint, 0, x, y, 1, s_feet_image_xscale, direction, c_white, 0.4);
    surface_reset_target();   
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Instance count

draw_text(x, y + 30, instance_count);

</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
